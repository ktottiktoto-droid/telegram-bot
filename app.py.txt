# app.py
from flask import Flask, request, jsonify
import requests
import os

app = Flask(__name__)

# === –ó–ê–ú–ï–ù–ò –ù–ê –°–í–û–ô –¢–û–ö–ï–ù ===
TOKEN = os.getenv("BOT_TOKEN", "8432529632:AAEJVSEF7a9MN9lx-Fp8vcsKv5WRPLS2NcA")
URL = f"https://api.telegram.org/bot{TOKEN}/"

def send_message(chat_id, text):
    url = URL + "sendMessage"
    payload = {"chat_id": chat_id, "text": text, "parse_mode": "HTML"}
    try:
        requests.post(url, json=payload)
    except Exception as e:
        print("–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏:", e)

@app.route('/')
def home():
    return "<h1>ü§ñ –ë–æ—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ Render!</h1><p>–ù–µ –∑–∞–∫—Ä—ã–≤–∞–π –≤–∫–ª–∞–¥–∫—É. –í–µ–±—Ö—É–∫ —É–∂–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω.</p>"

@app.route('/webhook', methods=['POST'])
def webhook():
    data = request.get_json()
    if not data:
        return "No data", 400

    if 'message' in data:
        message = data['message']
        chat_id = message['chat']['id']
        text = message.get('text', '')
        user = message['from'].get('first_name', '–ê–Ω–æ–Ω–∏–º')

        if text == '/start':
            send_message(chat_id, f"–ü—Ä–∏–≤–µ—Ç, {user}! üöÄ –ë–æ—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ <b>Render.com</b>!")
        elif text == '/help':
            send_message(chat_id, "–ü–æ–∫–∞ —è —É–º–µ—é —Ç–æ–ª—å–∫–æ /start –∏ /help")
        else:
            send_message(chat_id, f"–¢—ã –Ω–∞–ø–∏—Å–∞–ª: <b>{text}</b>\n\n–Ø –ø–æ–ª—É—á–∏–ª —Ç–≤–æ—ë —Å–æ–æ–±—â–µ–Ω–∏–µ!")

    return "ok", 200